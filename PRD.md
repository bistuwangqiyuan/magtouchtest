# 接触式三探头磁检测软件 - 产品需求文档 (PRD)

## 1. 产品概述

### 1.1 产品定位
接触式三探头磁检测软件是一款面向工业无损检测领域的专业检测软件，用于金属材料表面和近表面缺陷的磁粉检测。系统采用三探头同步检测技术，提供实时数据采集、波形分析、缺陷识别和报告生成等功能。

### 1.2 目标用户
- 工业检测工程师
- 质量控制人员
- 设备操作员
- 检测实验室技术人员

### 1.3 核心价值
- **高效检测**: 三探头同步工作，提高检测效率3倍
- **精准分析**: 实时波形显示，支持多种分析算法
- **数据追溯**: 完整的历史记录，支持质量追溯
- **易于操作**: 触摸屏友好的工业风格界面

## 2. 功能需求

### 2.1 核心功能模块

#### 2.1.1 实时检测模块
**功能描述**: 三探头实时数据采集和显示

**详细需求**:
- [P0] 支持三个探头同步数据采集
- [P0] 实时波形显示（采样率可配置：100Hz-10kHz）
- [P0] 探头状态监控（在线/离线/异常）
- [P1] 自动增益控制（AGC）
- [P1] 噪声过滤和信号平滑
- [P2] 支持多种触发模式（连续/单次/外部触发）

**技术指标**:
- 数据刷新率: ≥30fps
- 延迟: <100ms
- 支持探头数量: 3个（可扩展至6个）

#### 2.1.2 波形显示模块
**功能描述**: 多通道波形实时渲染和分析

**详细需求**:
- [P0] 支持三通道同时显示
- [P0] 波形缩放（时间轴和幅度轴）
- [P0] 游标测量功能
- [P1] 波形叠加对比
- [P1] 频谱分析（FFT）
- [P2] 波形录制和回放

**UI要求**:
- 深色背景（#1a1a1a）
- 橙色波形线（#ff8c00）
- 网格线（#333333）
- 测量标记清晰可见

#### 2.1.3 参数配置模块
**功能描述**: 检测参数的设置和管理

**详细需求**:
- [P0] 探头参数配置（增益、频率、滤波器）
- [P0] 闸门设置（检测范围、阈值、延迟）
- [P0] DAC/AVG曲线配置
- [P1] 参数预设管理（保存/加载/分享）
- [P1] 参数模板库（按材料/标准分类）
- [P2] 参数自动优化建议

**配置项**:
```yaml
探头配置:
  - 探头1-3: 
    - 增益: 0-80dB (步进0.5dB)
    - 频率: 0.5-20MHz
    - 滤波: 低通/高通/带通
    
闸门配置:
  - 闸门A/B:
    - 起始位置: 0-999mm
    - 宽度: 1-999mm
    - 阈值: 0-100%
    
系统配置:
  - 采样率: 100Hz-10kHz
  - 平均次数: 1-256
  - 检波模式: 全波/正半波/负半波
```

#### 2.1.4 数据管理模块
**功能描述**: 检测数据的存储、查询和管理

**详细需求**:
- [P0] 检测记录自动保存
- [P0] 历史数据查询（按日期/工件/操作员）
- [P0] 数据导出（CSV/Excel）
- [P1] 数据统计分析（缺陷分布、合格率）
- [P1] 批量数据处理
- [P2] 数据同步和备份

**数据结构**:
- 检测记录: 工件信息、检测参数、波形数据、缺陷信息
- 配置记录: 参数模板、用户设置
- 操作日志: 用户操作、系统事件

#### 2.1.5 报告生成模块
**功能描述**: 自动生成检测报告

**详细需求**:
- [P0] PDF报告生成（包含波形截图、数据表格）
- [P1] 自定义报告模板
- [P1] 批量报告生成
- [P2] 报告签名和审批流程

**报告内容**:
- 基本信息: 工件编号、检测日期、操作员
- 检测参数: 探头设置、标准依据
- 检测结果: 波形图、缺陷位置、评定结论
- 附加信息: 设备校准、环境条件

### 2.2 辅助功能

#### 2.2.1 工件管理
- 工件信息录入（编号、材质、尺寸）
- 工件模板管理
- 检测计划制定

#### 2.2.2 用户管理
- 用户登录/注销
- 权限控制（操作员/工程师/管理员）
- 操作日志记录

#### 2.2.3 系统设置
- 界面语言切换（中文/英文）
- 主题配置（工业橙/工业蓝）
- 系统校准和自检

## 3. 非功能需求

### 3.1 性能要求
- 页面加载时间: <2s
- 数据采集延迟: <100ms
- 波形渲染帧率: ≥30fps
- 支持并发用户: 10+

### 3.2 兼容性要求
- 浏览器: Chrome/Edge/Firefox (最新版本)
- 设备: 桌面端、平板端（10寸以上）
- 分辨率: 1024x768 及以上

### 3.3 安全性要求
- 用户身份验证
- 数据加密存储
- 操作权限控制
- 审计日志完整

### 3.4 可靠性要求
- 系统可用性: ≥99%
- 数据备份: 每日自动备份
- 故障恢复: <30分钟

### 3.5 可维护性要求
- 代码模块化，易于扩展
- 完整的开发文档
- 单元测试覆盖率 ≥80%

## 4. 界面设计规范

### 4.1 设计风格
**工业风格特征**:
- 深色主题，减少屏幕刺眼
- 高对比度，确保信息清晰
- 大按钮设计，适合触摸操作
- 橙色作为强调色，警示色为红色

### 4.2 色彩规范
```css
主色调:
  - 背景色: #1a1a1a (深黑)
  - 次级背景: #2d2d2d (深灰)
  - 面板背景: #3a3a3a (中灰)

强调色:
  - 主强调色: #ff8c00 (工业橙)
  - 成功色: #00ff00 (绿色)
  - 警告色: #ffcc00 (黄色)
  - 错误色: #ff0000 (红色)

文字色:
  - 主文字: #ffffff (白色)
  - 次要文字: #cccccc (浅灰)
  - 禁用文字: #666666 (暗灰)

边框和分割线:
  - 边框: #444444
  - 分割线: #333333
  - 网格线: #2a2a2a
```

### 4.3 布局规范
```
┌─────────────────────────────────────────────┐
│  顶部状态栏 (参数显示、状态信息)              │
├──────┬───────────────────────────────┬──────┤
│      │                               │      │
│ 左侧 │     主显示区                   │ 右侧 │
│ 功能 │  (波形显示/参数配置)            │ 操作 │
│ 按钮 │                               │ 按钮 │
│ 区   │                               │ 区   │
│      │                               │      │
├──────┴───────────────────────────────┴──────┤
│  底部控制栏 (全局操作按钮)                    │
└─────────────────────────────────────────────┘
```

### 4.4 组件规范
- 按钮: 最小尺寸60x60px，圆角4px
- 输入框: 高度44px，边框1px
- 图标: 尺寸32x32px或24x24px
- 字体: 主字号16px，标题20px，小字12px

## 5. 技术栈

### 5.1 前端技术
- **框架**: Astro 4.x (静态站点生成)
- **UI库**: Tailwind CSS 3.x (样式)
- **图表**: Chart.js / Canvas API (波形渲染)
- **状态管理**: Zustand (轻量级状态管理)
- **类型检查**: TypeScript 5.x

### 5.2 后端服务
- **数据库**: Supabase (PostgreSQL)
- **认证**: Supabase Auth
- **存储**: Supabase Storage (波形数据、报告文件)
- **实时通信**: Supabase Realtime (可选)

### 5.3 部署方案
- **托管平台**: Netlify
- **CI/CD**: GitHub Actions
- **域名**: 自定义域名
- **SSL**: 自动HTTPS

## 6. 数据模型

### 6.1 核心数据表

#### users (用户表)
```sql
- id: uuid (PK)
- email: text
- full_name: text
- role: enum (operator/engineer/admin)
- created_at: timestamp
```

#### workpieces (工件表)
```sql
- id: uuid (PK)
- workpiece_no: text (工件编号)
- material: text (材质)
- dimensions: jsonb (尺寸信息)
- standard: text (检测标准)
- created_at: timestamp
```

#### detection_records (检测记录表)
```sql
- id: uuid (PK)
- workpiece_id: uuid (FK)
- operator_id: uuid (FK)
- detection_date: timestamp
- parameters: jsonb (检测参数)
- probe1_data: jsonb (探头1数据)
- probe2_data: jsonb (探头2数据)
- probe3_data: jsonb (探头3数据)
- defects: jsonb (缺陷信息)
- conclusion: text (检测结论)
- report_url: text (报告文件URL)
- created_at: timestamp
```

#### parameter_templates (参数模板表)
```sql
- id: uuid (PK)
- template_name: text
- material_type: text
- parameters: jsonb
- is_default: boolean
- created_by: uuid (FK)
- created_at: timestamp
```

#### system_logs (系统日志表)
```sql
- id: uuid (PK)
- user_id: uuid (FK)
- action: text
- details: jsonb
- ip_address: text
- created_at: timestamp
```

## 7. 开发计划

### Phase 1: 基础框架 (Week 1-2)
- [ ] 项目初始化和配置
- [ ] Supabase数据库设计和创建
- [ ] 基础UI框架和组件库
- [ ] 用户认证系统

### Phase 2: 核心功能 (Week 3-4)
- [ ] 三探头数据采集模拟
- [ ] 波形显示组件
- [ ] 参数配置界面
- [ ] 数据存储功能

### Phase 3: 高级功能 (Week 5-6)
- [ ] 报告生成系统
- [ ] 历史数据查询
- [ ] 数据分析功能
- [ ] 工件管理系统

### Phase 4: 测试和优化 (Week 7-8)
- [ ] 单元测试
- [ ] 集成测试
- [ ] 性能优化
- [ ] 部署和上线

## 8. 验收标准

### 8.1 功能验收
- [ ] 所有P0功能100%完成
- [ ] 所有P1功能≥80%完成
- [ ] 核心流程测试通过率100%

### 8.2 性能验收
- [ ] 页面加载时间<2s
- [ ] 波形渲染帧率≥30fps
- [ ] 数据采集延迟<100ms

### 8.3 质量验收
- [ ] 单元测试覆盖率≥80%
- [ ] 无严重bug
- [ ] 代码审查通过

## 9. 风险和缓解

### 9.1 技术风险
**风险**: Canvas波形渲染性能不足
**缓解**: 使用WebGL加速，数据降采样

**风险**: 实时数据采集延迟
**缓解**: WebSocket长连接，优化数据结构

### 9.2 进度风险
**风险**: 开发周期紧张
**缓解**: 分阶段交付，优先P0功能

## 10. 附录

### 10.1 参考标准
- GB/T 15822-2019 《磁粉检测》
- ASTM E1444-16 《磁粉检测标准实施规程》
- EN ISO 9934-1 《无损检测-磁粉检测》

### 10.2 术语表
- **探头(Probe)**: 磁检测传感器
- **闸门(Gate)**: 检测范围设置
- **DAC**: 距离-幅度曲线
- **AVG**: 距离-速度-增益曲线
- **缺陷(Defect)**: 材料不连续性

---

**文档版本**: v1.0  
**创建日期**: 2025-10-05  
**最后更新**: 2025-10-05  
**负责人**: AI全栈开发团队
