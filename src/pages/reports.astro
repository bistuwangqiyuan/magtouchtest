---
/**
 * 报告管理页面
 */

import MainLayout from '@/layouts/MainLayout.astro';

const title = '报告管理 - 专业PDF检测报告生成与管理 | 磁检测系统';
const description = '智能检测报告生成系统。一键生成符合国际标准的PDF检测报告，包含波形截图、数据表格、缺陷分析、检测结论等完整信息。支持批量报告生成、报告预览、下载等功能。报告格式完全符合GB/T、ASTM、ISO标准要求。';
const keywords = '检测报告,PDF报告,报告生成,批量报告,报告管理,报告下载,检测结论,波形报告,标准报告,质量报告';
---

<MainLayout 
  title={title}
  description={description}
  keywords={keywords}
>
  <div class="p-6">
    <div class="flex items-center justify-between mb-6">
      <h1 class="text-2xl font-bold">检测报告管理</h1>
      <button class="btn-primary" onclick="generateBatchReport()">批量生成报告</button>
    </div>
    
    <!-- 报告列表 -->
    <div class="panel">
      <table class="table">
        <thead>
          <tr>
            <th>报告编号</th>
            <th>工件编号</th>
            <th>检测日期</th>
            <th>操作员</th>
            <th>结论</th>
            <th>生成时间</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody id="report-list">
          <tr>
            <td colspan="7" class="text-center text-text-secondary py-8">
              加载中...
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</MainLayout>

<script>
  async function loadReports() {
    const tbody = document.getElementById('report-list');
    if (!tbody) return;
    
    // 演示数据
    const reports = [
      {
        id: 'RPT-2025-001',
        workpiece_no: 'WP-2025-001',
        detection_date: '2025-10-05',
        operator: '李操作员',
        conclusion: '发现2处缺陷',
        generated_at: '2025-10-05 15:00:00',
      },
      {
        id: 'RPT-2025-002',
        workpiece_no: 'WP-2025-002',
        detection_date: '2025-10-05',
        operator: '王操作员',
        conclusion: '检测合格',
        generated_at: '2025-10-05 14:00:00',
      },
    ];
    
    tbody.innerHTML = reports.map(r => `
      <tr>
        <td class="font-semibold text-accent-primary">${r.id}</td>
        <td>${r.workpiece_no}</td>
        <td>${r.detection_date}</td>
        <td>${r.operator}</td>
        <td>${r.conclusion}</td>
        <td>${r.generated_at}</td>
        <td>
          <button class="btn-sm btn-primary mr-2" onclick="downloadPDF('${r.id}')">下载PDF</button>
          <button class="btn-sm btn-secondary" onclick="viewReport('${r.id}')">预览</button>
        </td>
      </tr>
    `).join('');
  }
  
  (window as any).generateBatchReport = () => {
    alert('批量报告生成功能（演示）');
  };
  
  (window as any).downloadPDF = (id: string) => {
    alert(`下载PDF报告: ${id}`);
  };
  
  (window as any).viewReport = (id: string) => {
    alert(`预览报告: ${id}`);
  };
  
  document.addEventListener('DOMContentLoaded', loadReports);
</script>
